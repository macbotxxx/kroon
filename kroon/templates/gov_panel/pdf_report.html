{% load static crispy_forms_tags humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>This report was generated by the Kroon Network. Your report reference number is : KSA-
    332221-2023</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
</head>
<body onload="printPromot()">

  <div class="container text-center">

    <div class="row">
      <div class="col order-last">
          
        <img src="{% static 'gov_panel/flag.png' %}" style="height: 70%; width: 170px;" alt="" srcset="">
      </div>
      <div class="col">
        <h3 >NATIONAL SME REPORT</h3>
        <h3 >{{ today.date }}</h3>
      </div>
      <div class="col order-first">
        <img src="{% static 'gov_panel/kiosk.png' %}" style="height: 70%; width: 170px;" alt="" srcset="">
      </div>
    </div>

  
        <p style="font-style: italic;" class="fs-5">
          Blekie Technologies does not represent or endorse the accuracy or reliability of any advice, opinion,
          statement or any other information displayed or distributed through this report. The estimates and the
          data contained herein are made using the information provided by government supported merchants
          on the Kroon network, Kroon Kiosk trade data and data from different industries.

      </p>


      <p class="fs-5">
          The data displayed in this report is generated from the trade data of the
           merchants as extracted from the Kroon Kiosk platform on
            {{ today.date }}. The period of date available in this report is from Feb 02,2023 to {{ today.date }}.
          Sector Merchants

      </p>
      




  <!-- total merchant  -->




    <div class="row">
      <div class="col">
        <h4>Total Merchants</h4>
        <h5>{{ all_active_user | intcomma }} </h5>
      </div>
      <div class="col">
        <h4>Total Revenue </h4>
       <h5> {{ request.user.default_currency_id }} {{revenue | intcomma }} </h5>
      </div>
      <div class="col">
        <h4>Total Cost Of Sales </h4>
       <h5>{{ request.user.default_currency_id }} {{ cost_of_sales | intcomma }} </h5>
      </div>

     
    </div>

    <h3>National Performance</h3>
    <hr>
    <div class="row">
        <!-- first report char -->
        <div class="col">
          <canvas id="totalSales" style="width:100%;max-width:600px"></canvas>
        </div>
        <div class="col">
          <canvas id="merchantSector" style="width:100%;max-width:600px"></canvas>
        </div>
    </div>

    <div class="row">
      <div class="col">
       <p class="fs-5">The <b>total sales</b> is the combined total sales conducted
        by merchants during the above period. <br><br>
        These sales include all payment methods of cash, card,
        mobile money and other payment methods such as
        BNPL, E-wallets and P2P payments.</p>
      </div>
      <div class="col">
        <table class="table">
          <thead>
            <tr>
              
              <th scope="col">Sector</th>
              <th scope="col">Merchants Sales Count</th>
              <th scope="col">Sales Amount</th>
            </tr>
          </thead>
          <tbody>
            {% for i in best_selling_category %}

            <tr>
              
              <td>{{i.product__category__category | title}}</td>
              <td>{{i.total_merchants | intcomma}}</td>
              <td>{{ request.user.default_currency_id }} {{i.total_revenue | intcomma}}</td>
            </tr>
      
          {% endfor %}
            
          </tbody>
        </table>
      </div>
    </div>

    <div>
      <h3> Provincial Performance</h3>
    <hr>

      <p >The data displayed in this report is generated from the trade data of the
        <Gov_Name_DeptName> merchants as extracted from the Kroon Kiosk platform on
        06/01/2023. The period of data available in this report is 05/12/2022 - 06/01/2023.</p>
    </div>

    <table class="table" style="border: 1px solid black;">
      <thead>
        <tr>
          <th scope="col">Province</th>
          <th scope="col">Merchants</th>
          <th scope="col">Sales</th>
          <th scope="col">Cost Of Sales</th>
          <th scope="col">Active Merchant</th>
        </tr>
      </thead>
      <tbody>
      {% for i in province_data %}
        <tr>
          <td>{{i.province | title}}</td>
          <td>{{i.total_merchants | intcomma}}</td>
         
          <td> {% if i.total_sales  %} {% for t in i.total_sales %} {{ request.user.default_currency_id }}  {{t.total_sale | intcomma}}  {% endfor %} {% else %} 0 {% endif %} </td>

          <td>{% if i.total_sales  %} {% for t in i.total_sales %} {{ request.user.default_currency_id }}  {{t.cost_of_sales_province | intcomma}}  {% endfor %} {% else %} 0 {% endif %}</td>

          <td>{{i.total_merchants | intcomma}}</td>

        </tr>
      {% endfor %}
      </tbody>
    </table>




<!-- province report  -->

    {% for p in province_data %}

   <h3>{{ p.province | title }} Performance</h3>
    <hr>
    <div class="row">
        <!-- first report char -->
        <div class="col">
          <canvas id="{{p.province_id}}1" style="width:100%;max-width:600px"></canvas>
        </div>
        <div class="col">
          <canvas id="{{p.province_id}}2" style="width:100%;max-width:600px"></canvas>
        </div>
    </div>

    <div class="row">
      <div class="col">
       <p class="fs-5">The <b>total sales</b> is the combined total sales conducted
        by merchants during the above period. <br><br>
        These sales include all payment methods of cash, card,
        mobile money and other payment methods such as
        BNPL, E-wallets and P2P payments.</p>
      </div>
      <div class="col">
        <table class="table">
          <thead>
            <tr>
              
              <th scope="col">Sector</th>
              <th scope="col">Merchants Sales Count</th>
              <th scope="col">Sales Amount</th>
            </tr>
          </thead>
          <tbody>
            {% if p.province_best_selling_category %}

            {% for i in p.province_best_selling_category %}

            <tr>
              
              <td>{{i.product__category__category | title}}</td>
              <td>{{i.total_merchants | intcomma}}</td>
              <td>{{ request.user.default_currency_id }} {{i.total_revenue | intcomma}}</td>
            </tr>
      
          {% endfor %}

          {% else %}

          <h5>No Records For {{ p.province | title }}</h5>
          
          {% endif %}
          </tbody>
        </table>
      </div>
    </div>

    {% endfor %}




  </div>





  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD" crossorigin="anonymous"></script>


<!-- all merchant total sales  -->
<script>
  var xValues = [ {% for s in sales_payments_type %}"{{ s.payment_method }} - {{ request.user.default_currency_id }} {{ s.total_revenue | intcomma }}", {% endfor %} ];
  var yValues = [ {% for s in sales_payments_type %} {{ s.total_revenue }}, {% endfor %}];
  
  var barColors = [
    "#3f57d1",
    "#0b7a25",
    "#b91d47",
    "#e8c3b9",
    "#00aba9"
  ];
  
  new Chart("totalSales", {
    type: "doughnut",
    data: {
      labels: xValues,
      datasets: [{
        backgroundColor: barColors,
        data: yValues
      }]
    },
    options: {
      title: {
        display: true,
        text: "Total Sales"
      }
    }
  });
  </script>

<script>
  var xValues = [ {% for s in best_selling_category %}'{{s.product__category__category | title}}  {{ request.user.default_currency_id }} {{s.total_revenue | intcomma }} ',{% endfor %} ];
  var yValues = [ {% for s in best_selling_category %}{{s.total_revenue }},{% endfor %} ];
  var barColors = ["#2c73d1","#2c73d1","#2c73d1","#2c73d1","#2c73d1","#2c73d1","#2c73d1"];
  
  new Chart("merchantSector", {
    type: "bar",
    data: {
      labels: xValues,
      datasets: [{
        backgroundColor: barColors,
        data: yValues
      }]
    },
    options: {
      legend: {display: false},
      title: {
        display: true,
        text: "{{ p.province | title }} Merchant Sectors Top 5"
      }
    }
  });
  </script>



<!-- province report script -->
{% for p in province_data %}
<script>
  var xValues = [ {% if p.province_sales_payments_type %} 
                      {% for s in p.province_sales_payments_type %}
                      "{{ s.payment_method }} - {{ request.user.default_currency_id }} {{ s.total_revenue | intcomma }}", 
                      {% endfor %}
                  {% else %}
                    "No Record For {{ p.province }}",
                  {% endif %}
                ];
  var yValues = [{% if p.province_sales_payments_type %} {% for s in p.province_sales_payments_type %} {{ s.total_revenue }}, {% endfor %} {% else %} 0 {% endif %} ];
  
  var barColors = [
    "#3f57d1",
    "#0b7a25",
    "#b91d47",
    "#e8c3b9",
    "#00aba9"
  ];
  
  new Chart("{{p.province_id}}1", {
    type: "doughnut",
    data: {
      labels: xValues,
      datasets: [{
        backgroundColor: barColors,
        data: yValues
      }]
    },
    options: {
      title: {
        display: true,
        text: "{{ p.province }} Total Sales"
      }
    }
  });
  </script>

<script>
  var xValues = [ {% for s in p.province_best_selling_category %}'{{s.product__category__category | title}}  {{ request.user.default_currency_id }} {{s.total_revenue | intcomma }} ',{% endfor %} ];
  var yValues = [ {% for s in p.province_best_selling_category %}{{s.total_revenue }},{% endfor %} ];
  var barColors = ["#2c73d1","#2c73d1","#2c73d1","#2c73d1","#2c73d1","#2c73d1","#2c73d1"];
  
  new Chart("{{p.province_id}}2", {
    type: "bar",
    data: {
      labels: xValues,
      datasets: [{
        backgroundColor: barColors,
        data: yValues
      }]
    },
    options: {
      legend: {display: false},
      title: {
        display: true,
        text: "{{ p.province | title }} Merchant Sectors Top 5"
      }
    }
  });
  </script>

{% endfor %}
<script>
  function printPromot() {
      window.print();
  }
</script>
</body>
</html>